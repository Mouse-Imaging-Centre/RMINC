<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>mincified version of lmer from lme4 — mincLmer • RMINC</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="mincified version of lmer from lme4 — mincLmer" />

<meta property="og:description" content="mincLmer should be used the same way as a straight lmer call, except
that the left hand side of the equation contains minc filenames rather than
an actual response variable." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">RMINC</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">1.5.2.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/Mouse-Imaging-Centre/RMINC">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>mincified version of lmer from lme4</h1>
    <small class="dont-index">Source: <a href='https://github.com/Mouse-Imaging-Centre/RMINC/blob/master/R/minc_lmer.R'><code>R/minc_lmer.R</code></a></small>
    <div class="hidden name"><code>mincLmer.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>mincLmer should be used the same way as a straight lmer call, except
that the left hand side of the equation contains minc filenames rather than
an actual response variable.</p>
    
    </div>

    <pre class="usage"><span class='fu'>mincLmer</span>(<span class='no'>formula</span>, <span class='no'>data</span>, <span class='no'>mask</span>, <span class='kw'>parallel</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>REML</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>control</span> <span class='kw'>=</span> <span class='fu'>lmerControl</span>(), <span class='kw'>start</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>0L</span>,
  <span class='kw'>temp_dir</span> <span class='kw'>=</span> <span class='fu'>getwd</span>(), <span class='kw'>safely</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>cleanup</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>summary_type</span> <span class='kw'>=</span> <span class='st'>"fixef"</span>, <span class='kw'>weights</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>resources</span> <span class='kw'>=</span> <span class='fu'>list</span>(),
  <span class='kw'>conf_file</span> <span class='kw'>=</span> <span class='fu'>getOption</span>(<span class='st'>"RMINC_BATCH_CONF"</span>))</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>formula</th>
      <td><p>the lmer formula, filenames go on left hand side</p></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p>the data frame, all items in formula should be in here</p></td>
    </tr>
    <tr>
      <th>mask</th>
      <td><p>the mask within which lmer is solved</p></td>
    </tr>
    <tr>
      <th>parallel</th>
      <td><p>how many processors to run on (default=single processor).
Specified as a two element vector, with the first element corresponding to
the type of parallelization, and the second to the number
of processors to use. For local running set the first element to "local" or "snowfall"
for back-compatibility, anything else will be run with batchtools see <a href='pMincApply.html'>pMincApply</a>.
Leaving this argument NULL runs sequentially and may take a long time.</p></td>
    </tr>
    <tr>
      <th>REML</th>
      <td><p>whether to use use Restricted Maximum Likelihood or Maximum Likelihood</p></td>
    </tr>
    <tr>
      <th>control</th>
      <td><p>lmer control function</p></td>
    </tr>
    <tr>
      <th>start</th>
      <td><p>lmer start function</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>lmer verbosity control</p></td>
    </tr>
    <tr>
      <th>temp_dir</th>
      <td><p>A directory to create temporary mask and registry files if 
<code>parallel = c("sge", n)</code>. This should not be <code>tempdir()</code> so that workers can see
these files. Defaults to the current working directory.</p></td>
    </tr>
    <tr>
      <th>safely</th>
      <td><p>whether or not to wrap the per-voxel lmer code in an exception catching
block (<code>tryCatch</code>), when TRUE this will downgrade errors to warnings and return
NA for the result.</p></td>
    </tr>
    <tr>
      <th>cleanup</th>
      <td><p>Whether or not to cleanup registry files after a queue parallelized 
run</p></td>
    </tr>
    <tr>
      <th>summary_type</th>
      <td><p>Either one of</p><ul>
<li><p>fixef: default and equivalent to older versions of RMINC, returns fixed effect coefficients and t-values</p></li>
<li><p>ranef: returns random effect coefficients and t-values</p></li>
<li><p>both: both fixed and random effects</p></li>
<li><p>anova: return the F-statistic for each fixed effect</p></li>
</ul><p>or a function to be used to generate the summary</p></td>
    </tr>
    <tr>
      <th>weights</th>
      <td><p>weights to be applied to each observation</p></td>
    </tr>
    <tr>
      <th>resources</th>
      <td><p>A list of resources to use for the jobs, for example
<code> list(nodes = 1, memory = "8G", walltime = "01:00:00") </code>. See
<code>system.file("parallel/pbs_script.tmpl", package = "RMINC")</code> and
<code>system.file("parallel/sge_script.tmpl", package = "RMINC")</code> for
more examples</p></td>
    </tr>
    <tr>
      <th>conf_file</th>
      <td><p>A batchtools configuration file</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>a matrix where rows correspond to number of voxels in the file and columns to
the number of terms in the formula, with both the beta coefficient and the t-statistic
being returned. In addition, an extra column keeps the log likelihood, and another
whether the mixed effects fitting converged or not.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>mincLmer provides an interface to running linear mixed effects models at every
voxel. Unlike standard mincLm, however, testing hypotheses in linear mixed effects models
is more difficult, since the denominator degrees of freedom are more difficult to
determine. RMINC provides two alternatives: (1) estimating degrees of freedom using the
<code><a href='mincLmerEstimateDF.html'>mincLmerEstimateDF</a></code> function, and (2) comparing two separate models using
<code><a href='mincLogLikRatio.html'>mincLogLikRatio</a></code> (which in turn can be corrected using
<code><a href='mincLogLikRatioParametricBootstrap.html'>mincLogLikRatioParametricBootstrap</a></code>). For the most likely models - longitudinal
models with a separate intercept or separate intercept and slope per subject - both of these
approximations are likely correct. Be careful in using these approximations if
using more complicated random effects structures. <br />
If you encounter memory issues, it could be due to minc file caching.
Consider trying with the environment variable MINC_FILE_CACHE_MB set to
a small value like 1.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code>lmer</code> for description of lmer and lmer formulas; <code><a href='mincLm.html'>mincLm</a></code></p></div>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='co'># NOT RUN {</span>
<span class='no'>vs</span> <span class='kw'>&lt;-</span> <span class='fu'>mincLmer</span>(<span class='no'>filenames</span> ~ <span class='no'>age</span> + <span class='no'>sex</span> + (<span class='no'>age</span><span class='kw'>|</span><span class='no'>id</span>), <span class='kw'>data</span><span class='kw'>=</span><span class='no'>gf</span>, <span class='kw'>mask</span><span class='kw'>=</span><span class='st'>"mask.mnc"</span>)
<span class='fu'><a href='mincWriteVolume.html'>mincWriteVolume</a></span>(<span class='no'>vs</span>, <span class='st'>"age-term.mnc"</span>, <span class='st'>"tvalue-age"</span>)
<span class='co'># run in parallel with multiple processors on the local machine</span>
<span class='no'>vs</span> <span class='kw'>&lt;-</span> <span class='fu'>mincLmer</span>(<span class='no'>filenames</span> ~ <span class='no'>age</span> + <span class='no'>sex</span> + (<span class='no'>age</span><span class='kw'>|</span><span class='no'>id</span>),
               <span class='kw'>data</span><span class='kw'>=</span><span class='no'>gf</span>,
               <span class='kw'>mask</span><span class='kw'>=</span><span class='st'>"mask.mnc"</span>,
               <span class='kw'>parallel</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='st'>"snowfall"</span>, <span class='fl'>4</span>))
<span class='co'># run in parallel with multiple processors over the sge batch queueing system</span>
<span class='no'>vs</span> <span class='kw'>&lt;-</span> <span class='fu'>mincLmer</span>(<span class='no'>filenames</span> ~ <span class='no'>age</span> + <span class='no'>sex</span> + (<span class='no'>age</span><span class='kw'>|</span><span class='no'>id</span>),
               <span class='kw'>data</span><span class='kw'>=</span><span class='no'>gf</span>,
               <span class='kw'>mask</span><span class='kw'>=</span><span class='st'>"mask.mnc"</span>,
               <span class='kw'>parallel</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='st'>"sge"</span>, <span class='fl'>4</span>))
<span class='co'># estimate degrees of freedom</span>
<span class='no'>vs</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='mincLmerEstimateDF.html'>mincLmerEstimateDF</a></span>(<span class='no'>vs</span>)
<span class='co'># correct for multiple comparisons using the False Discovery Rate</span>
(<span class='no'>qvals</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='mincFDR.html'>mincFDR</a></span>(<span class='no'>vs</span>))
<span class='co'># generate another model with a more complex curve for the age term</span>
<span class='fu'>library</span>(<span class='no'>splines</span>)
<span class='no'>vs2</span> <span class='kw'>&lt;-</span> <span class='fu'>mincLmer</span>(<span class='no'>filenames</span> ~ <span class='fu'><a href='http://www.rdocumentation.org/packages/splines/topics/ns'>ns</a></span>(<span class='no'>age</span>,<span class='fl'>2</span>) + <span class='no'>sex</span> + (<span class='no'>age</span><span class='kw'>|</span><span class='no'>id</span>), <span class='kw'>data</span><span class='kw'>=</span><span class='no'>gf</span>, <span class='kw'>mask</span><span class='kw'>=</span><span class='st'>"mask.mnc"</span>)
<span class='co'># see if that more complex age term was worth it</span>
<span class='no'>modelCompare</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='mincLogLikRatio.html'>mincLogLikRatio</a></span>(<span class='no'>vs</span>, <span class='no'>vs2</span>)
<span class='fu'><a href='mincFDR.html'>mincFDR</a></span>(<span class='no'>modelCompare</span>)
<span class='co'># see if there was any bias in those p-value estimates (takes a few minutes)</span>
<span class='no'>modelCompare</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='mincLogLikRatioParametricBootstrap.html'>mincLogLikRatioParametricBootstrap</a></span>(<span class='no'>modelCompare</span>)
<span class='fu'><a href='mincFDR.html'>mincFDR</a></span>(<span class='no'>modelCompare</span>)
<span class='co'># }</span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Jason Lerch, Chris Hammill, Matthijs van Eede, Daniel Cassel.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  

  </body>
</html>

